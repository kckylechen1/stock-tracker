# A股交易记忆助手 - 产品需求和解决方案文档

**文档版本**: v1.0  
**创建日期**: 2026-01-05  
**项目阶段**: 产品规划完成，准备进入开发

---

## 目录
1. [用户需求总结](#用户需求总结)
2. [产品形态定义](#产品形态定义)
3. [技术方案总结](#技术方案总结)
4. [后续讨论方向](#后续讨论方向)

---

## 用户需求总结

### 核心需求演变过程

#### 第一阶段：基础想法（2026-01-04 23:00）
**用户初期需求**：
- 想做一个web或app，支持多人和AI讨论股票
- 能记录几天要关注的股票（自选池）
- 类似同花顺但支持私人群组讨论
- 通过同花顺资金热点和雪球/股吧看热门股票

**痛点**：现有软件不支持协作讨论，无法记忆用户观点

---

#### 第二阶段：产品框架聚焦（2026-01-04 23:00-00:00）
**用户精准需求**：
- 类似Manus的AI套壳前端（不是通用AI，而是金融专用）
- 核心是提供记忆和分析，不做决策
- 架构：TODO + 多个Agent + 记忆机器人
- 本质是让大模型的金融脚手架"手和脚"更好用

**关键转变**：从多功能应用 → 聚焦AI辅助研究工具

---

#### 第三阶段：交易逻辑系统化（2026-01-04 00:30）
**用户补充需求**：
- 交易逻辑要模块化（Skill设计）
- 例如：龙头后补涨这类规则可以写成Skill
- 每个Skill可以用历史数据回测验证
- 支持参数优化（调整评分阈值、对比结果）

**关键洞察**：不只记录和分析，还要验证策略有效性

---

#### 第四阶段：界面极简化（2026-01-04 00:56）
**用户明确要求**：
- 界面必须简洁易懂，不要复杂
- 信息分层，只展示核心数据
- 卡片化而非表格
- 操作流程最少化（2-3步完成）

**用户理念**：新手能用，高手也爱用

---

#### 第五阶段：实用功能补充（2026-01-04 00:57）
**用户新增两个关键功能**：

1. **截图识别导入**
   - 可以截图其他平台的自选股列表
   - AI自动OCR识别股票代码/名称
   - 批量导入到今日观察池

2. **一键发布**
   - 将观察清单、分析报告、回测结果等内容
   - 一键同步到飞书、Notion等知识库
   - 支持双向同步（共享和协作）

**用户价值**：让数据流动起来，支持知识沉淀

---

#### 第六阶段：产品形态总结（2026-01-05 08:40）
**用户明确不需要**：
- 不需要技术细节讨论
- 聚焦产品形态和用户体验
- 先把产品逻辑清楚，再说开发

---

#### 第七阶段：技术部署确认（2026-01-05 08:50）
**用户的部署需求**：
- 初期用户：5-100人
- 云服务：阿里云
- 部署方式：Docker容器化
- 数据库：PostgreSQL
- 实时通讯：WebSocket
- AI集成：从一开始就规划

**用户态度**：云部署优先，不关心本地开发环节

---

### 用户核心价值主张

> **"让AI成为你的交易记事本，而不是决策者"**

通过**记忆、自主监控、数据验证**三大能力，帮助投资者：
- 💭 记住所有交易想法
- ⏰ 自动跟踪关注的股票
- 🤝 与朋友协作研究
- 📊 用数据验证策略靠谱性

---

## 产品形态定义

### 产品定位

**一个会记忆、能自主工作、可协作的A股交易研究助理**

- **不是通用聊天**：专注A股交易场景
- **不是投资建议**：只提供数据和分析，用户自己决策
- **不是实盘交易**：不对接券商，不执行买卖
- **不是复杂量化**：面向普通投资者，不是专业量化平台

---

### 核心功能（7大模块）

#### 功能1：聊天界面（记忆+协作）
**功能说明**：
- 与AI对话讨论股票（像聊天软件一样简单）
- 支持个人使用和群组协作
- AI自动记录对话，提取关键观点

**使用场景**：
- 个人："比亚迪我觉得有点高了"→AI记住这个观点
- 群组：多人讨论股票，AI自动整理每个人的观点
- @提及：随时@机器人查询或分析

**关键特性**：
- 自动识别股票代码/名称
- 保存完整对话历史（可搜索）
- 群组支持@提及和通知
- 支持文字、图片、语音输入

---

#### 功能2：观察池（TODO管理）
**功能说明**：
- 用户关注的股票清单
- 每只股票可设置备注、目标价、提醒条件
- 系统自动更新价格和状态

**信息架构**：
- 观察中（等待入场时机）
- 持仓提醒（已买入）
- 复盘清单（需要研究分析）

**每只股票包含**：
- 股票代码+名称
- 当前价格（实时更新）
- 目标价和用户备注
- 添加时间和理由
- 状态标签

**智能功能**：
- 自动生成：AI从对话中提取"等回调到260"自动创建TODO
- 触发提醒：价格到位、成交量异常、重要公告时推送
- 状态更新：自动标记"已达目标""已超预期"等

---

#### 功能3：交易策略库（Skill自动监控）
**功能说明**：
- 预设多个交易监控逻辑
- 每个策略自动运行，每天交付分析结果

**首批3个核心策略**：

**策略1：龙头补涨监控**
- 逻辑：龙头股涨停后，板块内其他股票可能补涨
- 监控规则：识别龙头→找补涨标的→评分排序
- 执行时间：每天14:00
- 输出：补涨候选清单（TOP 5）

**策略2：板块轮动监控**
- 逻辑：主线板块连涨后，资金可能轮动到关联板块
- 监控规则：识别主线→找关联板块→筛选滞涨品种
- 执行时间：每日收盘后
- 输出：可能轮动的板块和个股

**策略3：游资追踪**
- 逻辑：跟踪知名游资席位的买入动向
- 监控规则：抓取龙虎榜→识别游资席位→分析板块聚集
- 执行时间：龙虎榜发布时
- 输出：游资买入清单和板块偏好

**用户交互**：
- 启用/停用策略
- 调整参数（评分阈值、执行时间）
- 查看历史结果

---

#### 功能4：回测工具
**功能说明**：
- 用历史数据验证策略的有效性
- 输出核心指标：收益率、胜率、最大回撤、夏普比率等

**使用流程**：
1. 用户："帮我回测龙头补涨策略，最近3个月"
2. 系统后台异步执行（30秒-2分钟）
3. 完成通知："回测完成！收益+18.5%"
4. 展示报告：核心指标+交易明细+风险提示

**参数优化**：
- 用户可调整策略参数（如评分阈值60→70）
- 系统自动对比不同参数的表现
- 生成对比表格推荐最优参数

---

#### 功能5：记忆库
**功能说明**：
- 系统自动记录用户对每只股票的历史观点
- 可随时查询回顾

**记忆内容**：
- 用户说过的每句话（关于某只股票）
- 添加到观察池的时间和理由
- 历史操作记录（买入/卖出/观望）
- AI的分析建议历史

**查询方式**：
- "我之前怎么看比亚迪的？"
- 系统展示：时间线 + 历史观点变化

**用例**：
- 复盘时回顾自己的想法演变
- 验证自己的判断是否正确
- 积累交易经验

---

#### 功能6：截图识别导入
**功能说明**：
- 用户上传股票自选清单截图
- 系统自动识别股票代码/名称
- 快速导入到观察池

**使用场景**：
- 看到微信群/雪球大V分享的自选股截图
- 其他软件（同花顺、东财）的自选股列表
- 手写笔记拍照
- 券商研报中的股票列表

**操作流程**：
1. 用户上传截图
2. 系统OCR识别（2-5秒）
3. 展示识别结果（支持修正）
4. 用户确认
5. 批量添加到观察池

**智能处理**：
- 自动去重（已存在的不重复添加）
- 模糊匹配（"宁德"识别为"宁德时代"）
- 错误纠正提示

---

#### 功能7：一键发布
**功能说明**：
- 将观察清单、分析报告、回测结果等内容
- 一键同步到飞书、Notion等协作平台

**可发布内容**：
- 观察池（飞书多维表格，实时同步）
- 分析报告（飞书文档/Notion页面）
- 回测报告（Notion Database）
- 讨论记录（飞书文档，会议纪要格式）

**协作价值**：
- 团队知识共享
- 决策记录保存
- 长期策略积累

---

### 典型使用场景

#### 场景1：个人投资者日常
```
早上上班前：查看昨晚AI生成的市场报告 → 看观察池是否有触发提醒
中午休息：看到策略推送 → 查看详情 → 加入观察池 → 设置提醒
下班回家：复盘想法 → 问AI行情 → 一键发布到飞书备份
```

#### 场景2：投资小组协作
```
周一早会：讨论分工 → AI自动记录并分配任务
周三盘中：有人发现龙头 → AI自动找补涨标的 → 群组讨论
周五复盘：AI整理本周讨论内容 → 发布到Notion作周报
```

#### 场景3：策略验证和优化
```
初次使用：用户提供想法 → AI推荐预设策略 → 用户回测
验证通过：启用自动监控 → 每天获得分析结果
参数调整：策略效果下降 → 调整参数 → 重新回测
```

---

### 目标用户

**用户画像1：散户投资者**
- 白天上班没时间盯盘
- 想法很多但容易忘
- 需求：记住想法 + 自动提醒

**用户画像2：小型投资团队（3-5人）**
- 经常一起讨论股票
- 每个人负责不同板块
- 需求：协作平台 + 观点整理

**用户画像3：量化爱好者**
- 有交易想法但不会编程
- 想验证策略但不想学Python
- 需求：对话式回测

---

### 产品边界（明确不做）

❌ **不提供投资建议**
- 只分析数据和提供信息
- 所有内容附加免责声明
- 用户自行决策

❌ **不做实盘交易**
- 不对接券商接口
- 不执行买卖操作
- 只做研究和记录

❌ **不做复杂量化**
- 不是专业量化平台
- 只做简单策略回测
- 面向普通投资者

❌ **不做通用AI助手**
- 专注A股交易场景
- 不回答无关问题
- 保持产品聚焦

---

## 技术方案总结

### 架构全景

```
用户端（Web/Mobile）
        ↓
    HTTPS/WSS
        ↓
阿里云 ECS（Docker）
├─ Nginx（反向代理、SSL）
├─ Mattermost（聊天、群组、消息存储）
├─ PostgreSQL（数据库）
├─ Redis（缓存、会话）
└─ AI处理模块（异步）
        ↓
外部API接口
├─ 同花顺（行情数据）
├─ 雪球（讨论热度）
├─ 大模型API（通义千问/Claude）
└─ 飞书/Notion API（发布集成）
```

---

### 技术选型总结

#### 1. 聊天系统选择

**选择：Mattermost 后端 + 自定义React前端**

**为什么选Mattermost**：
- ✅ 专为团队设计，轻量级
- ✅ 自带完整UI（开箱即用）
- ✅ 支持群组、频道、私聊
- ✅ 开源，可自由定制
- ✅ 有完整API，易于集成
- ✅ 社区活跃，文档齐全

**为什么自定义前端**：
- ✅ Mattermost现成UI可用，但不符合"极简"要求
- ✅ 需要集成AI、记忆、观察池等自定义功能
- ✅ 通过API调用Mattermost后端
- ✅ 用React + WebSocket自建符合需求的UI

**对标方案**：
- Rocket.Chat（功能多但更重）
- Zulip（轻量但UI一般）
- 纯自建（工作量大，不推荐MVP阶段）

---

#### 2. 云部署方案

**选择：阿里云 ECS + Docker Compose**

**配置**：
- 地域：新加坡/香港（低延迟）
- 实例：ecs.t5.medium（2vCPU, 4GB RAM）
- 初期成本：约 ¥35-95/月

**部署模式**：
- 容器化（Docker Compose）
- 便于扩展和升级
- 自动重启、健康检查

**为什么不选择其他**：
- 不用ECS托管服务（失去灵活性）
- 不用Kubernetes（MVP阶段过度设计）
- Docker Compose够用，简单易维护

---

#### 3. 数据库方案

**选择：PostgreSQL + Redis**

**PostgreSQL**：
- 存储消息、用户数据、观察池
- 连接池使用PgBouncer
- 定期备份策略

**Redis**：
- 缓存热点数据
- 会话存储
- 实时计数器

---

#### 4. 实时通讯方案

**选择：WebSocket**

**为什么选WebSocket**：
- ✅ Mattermost原生支持
- ✅ 低延迟，实时推送
- ✅ 浏览器原生支持，无需额外库
- ✅ 消息秒级送达

**消息流**：
```
客户端消息 
  → Mattermost WebSocket接收
  → 存储到PostgreSQL
  → 触发Outgoing Webhook
  → AI处理（异步）
  → AI回复消息
  → WebSocket推送到所有客户端
```

---

#### 5. AI集成方案

**架构原则**：
- **异步处理**（不阻塞聊天）
- **消息队列**（Redis/RabbitMQ缓冲）
- **Webhook钩子**（捕获消息）

**集成点**：
1. 消息到达时 → Outgoing Webhook → AI服务
2. AI处理消息 → 提取观点 → 更新记忆库
3. AI生成回复 → 通过API发送到Mattermost
4. WebSocket推送给所有客户端

**支持的AI模型**：
- 通义千问（国内优先，低延迟）
- Claude（功能强但需科学上网）
- GPT-4o（贵，但准确度高）

---

#### 6. 数据源方案

**行情数据**：
- 同花顺API（官方接口，最全）
- Tushare（历史数据，免费）
- AKShare（覆盖A股全品类）

**讨论热度**：
- 雪球平台（热门讨论数据）
- 东方财富股吧（帖子数、浏览量）
- 同花顺资金热点（官方榜单）

---

### 部署流程概览

#### 准备阶段
1. 阿里云账户开通
2. 购买域名
3. 生成SSL证书（Let's Encrypt）
4. 创建ECS实例 + 配置安全组

#### 初始化阶段
1. SSH连接到ECS
2. 安装Docker + Docker Compose
3. 创建目录结构和持久化存储

#### 部署阶段
1. 编写 docker-compose.yml
2. 配置 .env 文件（数据库密码、域名等）
3. 配置 Nginx（反向代理、SSL）
4. 启动容器：docker-compose up -d

#### 验证阶段
1. 所有容器健康检查通过
2. HTTPS连接正常
3. 创建管理员账户
4. 测试消息发送/接收
5. WebSocket连接验证

---

### 成本预估（月度）

| 项目 | 费用 |
|------|------|
| ECS ecs.t5.medium | ¥15-25 |
| 存储100GB | ¥5-10 |
| 带宽2Mbps | ¥5-10 |
| 域名（首年） | ¥10-50 |
| **总计** | **¥35-95/月** |

当用户增长到100+时，可升级到 ecs.c6.large，成本增加到 ¥100-150/月。

---

### 扩展性规划

**当用户增长到100+时**：
1. 升级ECS实例规格
2. 启用数据库连接池（PgBouncer）
3. 添加Redis缓存层
4. Nginx负载均衡（多个Mattermost实例）

**当用户增长到1000+时**：
1. 迁移到Kubernetes（容器编排）
2. 数据库主从复制+读写分离
3. CDN加速（如需跨域用户）
4. 专业监控和告警系统

---

## 后续讨论方向

### 现阶段已完成
✅ 产品形态定义（7大功能）  
✅ 用户价值主张明确  
✅ 云部署架构方案  
✅ 技术选型决策  
✅ 成本预估  

### 待讨论的关键问题

#### 问题1：AI记忆系统如何设计？
- 如何存储用户的观点和决策？
- 如何在对话中自动提取和引用记忆？
- 如何处理观点的演变（用户改口）？
- 记忆的有效期怎么管理？

#### 问题2：Skill开发的治理
- 如何制定Skill的评估标准？
- 用户能否自定义Skill？
- 如何处理无效或错误的Skill？
- Skill库的社区共享机制？

#### 问题3：多人协作的权限管理
- 群组的权限划分（管理员/成员/只读）？
- 观察池是否支持共享？
- 发布到飞书/Notion时的权限如何对应？

#### 问题4：前端UI如何实现极简？
- 聊天+观察池+策略结果如何在一个界面展示？
- 移动端和Web端的适配策略？
- 卡片化设计的具体交互逻辑？

#### 问题5：开发优先级怎么排？
- MVP（最小可行产品）应该包含哪些功能？
- 第一版本的目标用户是谁？
- 什么时间点可以内测？

#### 问题6：商业化和合规
- 如何避免踩投资建议的红线？
- 免责声明如何设计？
- 数据合规和用户隐私如何保护？
- 未来如何盈利？

---

## 总结

### 产品本质
这是一个**AI驱动的A股交易研究工具**，核心价值是：
1. **记忆** - 不忘记用户的任何观点
2. **自主** - 自动监控和执行分析
3. **协作** - 支持团队讨论和知识共享
4. **验证** - 用数据验证交易想法

### 成功的关键
1. **聚焦** - 专注A股，不做通用AI
2. **简洁** - 界面和操作都要极简
3. **可信** - 清晰的免责声明和准确的数据
4. **实用** - 真正解决投资者的问题

### 推进方向
- ✅ 产品已定义清晰
- ✅ MVP 前端框架已完成（2026-01-06）
  - 三栏布局（自选股列表 + K线图区域 + AI助手）
  - 股票追踪和K线图功能
  - AI 聊天助手（流式响应 + 思考模式）
  - 资金指标和市场情绪面板
- 📍 下一步：对接真实数据API（资金流向、北向资金、市场情绪）

---

**文档完成日期**：2026-01-05 18:49  
**最后更新**：2026-01-06 23:24  
**下一次讨论议题**：资金流向API对接、筹码分布实现

