# 基于自然语言与LLM的选股/NLP策略设计文档（给产品经理）

**文档版本**：1.0  
**目标读者**：产品经理、架构师、核心开发  
**目标市场**：A股（可扩展至港股/美股）  
**核心定位**：

- 这是一个基于自然语言 + 大语言模型（LLM）+ 行情数据的选股辅助系统
- 不替用户做交易决策，只做：**选股建议、因子挖掘、经验沉淀、Skill 化复用**

---

## 1. 产品愿景与核心价值

### 1.1 一句话概括

> 把"会炒股的人脑子里的经验和直觉"，用自然语言固化成可复用的"选股 Skill"，由 LLM 自动执行扫描与筛选，长期沉淀为个人/团队的因子库，而不是只玩短期的量化数字游戏。

### 1.2 与传统量化/传统行情软件的区别

**传统量化：**

- 把"选股逻辑"写成数学公式 + 代码（如动量、价值、波动率因子）
- 依赖回测 + 高频交易，容易出现因子拥挤和容量问题
- 收益高度依赖 **交易执行效率**（撮合速度、滑点控制），策略生命周期有限

**传统行情软件：**

- 提供指标 + 条件选股（PE、换手率、量比等）
- 用户必须自己写公式/条件组合，门槛高
- 不具备"记忆"和"经验沉淀"能力

**本系统：**

- 用**自然语言**描述投资逻辑 → LLM 解析 → 转换为因子/筛选规则
- 系统长期记住：用户的每次筛选、复盘结果、成功/失败案例
- 自动把"经常被使用且有效"的逻辑，抽象成可复用的 **Skill**
- 每个 Skill 可以回测、评估"胜率 + 容量"，并与其他 Skill 组合

**关键认知点**：

- 传统量化是 **"数字游戏 + 高频交易"** → 容量有限、容易拥挤
- 我们做的是 **"自然语言 + 经验因子 + 中等频率交易"** → 容量更大、寿命更长

---

## 2. 核心概念定义（请务必读懂）

### 2.1 自然语言策略（NLP Strategy）

用户用"人话"描述一套选股逻辑，例如：

> "帮我找：最近 5–15 个交易日出现利好新闻、但股价没大涨、换手率在 3–10%、量比刚放大的票，优先板块里资金排名前 3 的行业，用来做 1–3 天的弱转强短线。"

这段自然语言包含多个 **隐性因子**：

- 事件/新闻驱动因子（有现实事件曝光）
- 价格滞后因子（股价尚未充分反应）
- 量能确认因子（量比>1、换手 3–10%）
- 板块资金梯度因子（资金前 3 的板块）

**系统要做的事**：

1. LLM 把这段话解析成结构化"因子配置"
2. 因子引擎根据行情/新闻/资金数据扫全市场
3. 输出候选股列表（带解释）

### 2.2 Skill（策略技能）

**Skill = 已沉淀的、可复用的策略模块**

特点：

- 来源于用户真实使用 + 回测验证
- 有名字、有配置、有统计数据（胜率、最大回撤、容量等）
- 可以被一键运行、组合、分享

例子：

- Skill-001《年终小盘避险策略》
- Skill-002《英特尔联动 A 股半导体》
- Skill-003《龙头涨停后的板块补涨》

### 2.3 因子（Factor）

系统内部仍然会用到**数值化因子**，但用户不需要直接接触。  
示例：

- 价量因子：过去 3 日涨幅、换手率、量比
- 资金因子：主力净流入、北向资金流向
- 情绪/新闻因子：新闻数、社交媒体热度
- 相关性因子：与某美股/指数的价格相关系数
- 季节性因子：时间窗口（如 11–1 月的小盘股效应）

---

## 3. 用户实际使用场景（产品视角）

### 场景 1：盘前用自然语言"一键建策略"

**用户**：

> "帮我找：
>
> - 卫星通信板块里，
> - 最近刚放量突破、但前 3 天涨幅不超过 15%，
> - 换手 5–15%，量比>1，
> - 今天集合竞价有大单托底的票。"

**系统流程**：

1. LLM 解析自然语言 → 因子配置 JSON（给后端）
2. 因子引擎根据 T-1 日数据做初筛（板块 + K 线形态 + 量能）
3. 开盘前 9:20 再用集合竞价数据做二次确认
4. 输出候选 5–8 只股票，按"潜在强度"排序
5. 用户可一键把这套逻辑保存为 **Skill-卫星弱转强短线**

### 场景 2：盘后复盘 + 策略沉淀成 Skill

**系统**：

> "你本周一共做了 5 次筛选，有 3 次都使用了类似逻辑：  
> '年终小盘股 + 资金净流入 + 换手 3–8%'。  
> 回测过去 3 年，这组逻辑在 11 月–1 月的胜率为 68%，  
> 是否将其固化为【年终小盘避险策略 Skill】？"

用户点"确认后"，系统自动：

- 生成 Skill 描述文档（自然语言 + 因子配置）
- 保存回测结果（收益曲线、最大回撤、容量估算等）
- 将该 Skill 加入"可一键运行"的策略列表

### 场景 3：事件驱动选股（英特尔大涨 → 找 A 股联动）

用户：

> "英特尔昨晚涨了 10%，帮我找走势最接近、且业务和它相关的 A 股。"

系统内部：

1. 从美股数据获取 INTC 的近 60/120/250 日价格序列
2. 扫描 A 股所有半导体/服务器/封测相关股票
3. 计算价格相关性（皮尔逊相关系数）
4. 结合产业链关系：
   - 服务器厂商（浪潮信息、中科曙光）
   - 封测厂、英特尔参股公司（长电科技、杰华特、南芯科技）
5. 输出：
   - 第一梯队：相关性高 + 产业链强绑定
   - 第二梯队：相关性中等 + 行业 Beta

用户可把这一整套逻辑保存为：  
**Skill-英特尔联动 A 股半导体**

---

## 4. 从自然语言到因子引擎：技术链路（高层）

> 这一部分重点是让产品经理/架构师理解模块拆分，便于技术设计。

### 4.1 总体架构（逻辑模块）

1. **NLP/LLM 层（理解人与策略）**
   - 职责：解析自然语言 → 策略结构；生成解释文本
   - 输入：用户对话、自然语言策略描述
   - 输出：
     - 策略结构化配置（JSON）
     - 对筛选结果的自然语言解释

2. **因子 & 数据引擎**
   - 职责：把结构化策略映射到具体字段 & 计算因子
   - 输入：
     - 策略 JSON（例如：`{"sector":"卫星通信","turnover":[3,10],...}`）
     - 市场数据（行情、资金、新闻、资金流入、板块排名等）
   - 输出：
     - 符合条件的股票列表（带因子值）

3. **Skill 管理与回测模块**
   - 职责：管理策略生命周期 & 评估有效性
   - Skill CRUD（创建/修改/删除/分享）
   - 回测引擎（历史数据验证胜率、最大回撤）
   - 容量评估（基于成交额、持仓周期、拥挤度）

4. **记忆与画像系统**
   - 职责：长期记住用户的偏好和规律
   - 记录用户每次筛选、操作结果、复盘笔记
   - 抽象"你最常用的 5 个规律"、"最近 30 天胜率最高的 3 个因子"
   - 给用户推荐应 Skill 化的逻辑

5. **前端交互层（App / Web）**
   - 对话式输入框 + 结构化筛选面板
   - 筛选结果列表 + K 线/分时联动
   - Skill 管理界面（开启/关闭/组合）

### 4.2 LLM 层需要做的事情（具体一点）

#### （1）策略意图识别

- 识别：
  - 选股 vs 复盘 vs 问答
  - 盘前扫描 vs 盘中动态监控 vs 长期组合构建

#### （2）自然语言 → 策略结构 JSON

举例输入：

> "帮我找过去 10 天有重大利好新闻、但股价没大涨（3 日涨幅 <15%）、换手 3–10%、量比刚放大的半导体股。"

输出 JSON 示例（给因子层看得懂）：

```json
{
  "universe": "A_SHARE",
  "sector": ["半导体", "芯片"],
  "event_window_days": [5, 15],
  "event_type": ["重大利好", "产业政策", "订单公告"],
  "price_change_3d_max": 0.15,
  "turnover_range": [3, 10],
  "volume_ratio_min": 1.0,
  "exclude_limit_up": true
}
```

#### （3）结果解释生成

在因子引擎给出候选股之后，让 LLM 帮用户做两件事：

1. 用简单的话讲清楚"为什么这只股票会被选出来"；
2. 用自然语言摘要策略逻辑，方便 Skill 化和分享；

---

## 5. Skill 设计规范（给产品/技术的"接口文档"）

### 5.1 Skill 元数据结构

```json
{
  "skill_id": "SKL-0001",
  "name": "年终小盘避险策略",
  "description_nl": "每年 11 月到次年 1 月，筛选资金持续流入、尚未大涨的小盘股，用于捕捉年终避险行情。",
  "created_by": "user_kyle",
  "created_at": "2026-01-08",
  "strategy_config": { ... },
  "tags": ["季节性", "小盘股", "资金流入"],
  "backtest": {
    "period": "2018-01-01 ~ 2025-12-31",
    "cagr": 0.28,
    "max_drawdown": 0.18,
    "sharpe": 1.4,
    "win_rate": 0.62,
    "capacity_estimate": "20亿"
  },
  "status": "ACTIVE"
}
```

### 5.2 Skill 生命周期

1. **发现期**：用户频繁用类似自然语言筛选
2. **建议期**：系统提示"是否固化为 Skill？"
3. **验证期**：自动触发回测 + 容量评估
4. **运行期**：用户正式启用，每日/每周自动运行
5. **评估期**：定期评估实际表现 VS 回测表现
6. **迭代期**：逻辑调整、因子更新（LLM 协助）
7. **退役期**：长期失效/拥挤度过高时，建议停用或重构

---

## 6. "容量问题"的产品化处理思路（简要）

### 6.1 为什么要显式考虑容量？

- 传统量化策略随资金规模增大，收益会明显下滑
- 原因：冲击成本 + 因子拥挤 + 标的池有限
- 我们虽然不是做高频，但只要用的是"公开逻辑 + 同一市场"，就会有 **容量上限**

### 6.2 产品层面怎么做？

1. **在 Skill 详情页展示容量估算**：
   - 基于该策略标的池的平均日成交额/换手率
   - 给一个建议区间，例如"建议资金规模不超过 10–15 亿"

2. **提示"拥挤风险"**：
   - 若系统检测到：
     - 这个 Skill 被大量用户使用
     - 或对应因子在公开研报/网上被高频讨论
   - 则在 UI 上打"高拥挤风险"标签

3. **鼓励用户个性化微调**：
   - 同一 Skill 提供一些开放参数（如市值区间、持仓周期等）
   - 让用户形成"个人版 Skill"，降低拥挤冲突概率

---

## 7. 对产品经理的关键建议

1. **一定要把"对话/自然语言"作为一等入口**
   - 不是先做条件选股，再加一个"机器人解释"
   - 而是：所有策略从"自然语言"出发，再落到因子

2. **Skill 不是量化策略库的换皮**
   - Skill 要有**人味**（名字、说明书、适用场景）
   - 同时要有**机器指标**（回测、容量、拥挤度）

3. **记忆系统一定要早期设计**
   - 用户所有"策略尝试 + 结果"都要可追踪
   - 否则无法做"你最近 30 天胜率最高的 3 个因子"这类智能总结

4. **MVP 建议**
   - 第一步：
     - 支持 1–2 个成熟场景（如"弱转强短线"、"事件驱动联动"）
     - 做好一条完整链路：自然语言 → 策略 JSON → 扫描 → 结果解释 → Skill 保存
   - 第二步：
     - 接入回测模块
     - 开始做简单容量估算
   - 第三步：
     - Skill 市场/分享
     - 多用户协作 + 因子拥挤监控

---

## 8. 可以直接给技术/架构的摘要（TL;DR）

- **前端**：对话框 + 结构化结果列表 + Skill 管理页
- **中台**：
  - LLM 服务（意图识别 + 策略解析 + 文本生成）
  - 策略/因子引擎（接行情/资金/新闻数据，执行扫描/回测）
  - Skill & 记忆服务（保存策略配置、回测结果、用户行为日志）
- **数据层**：
  - 行情 K 线 & 分时
  - 板块与行业分类
  - 资金流（主力、北向）
  - 新闻/研报/社交情绪
- **关键差异化**：
  - 一切从自然语言出发，并长期把"人类经验"沉淀成可复用的 Skill
  - 不与高频量化基金抢同一个赛道，而是站在更长期、更高容量的层面

---

## 9. 附录：与现有系统的对接点

### 9.1 现有 AI 分析功能 → NLP 策略的升级路径

| 现有功能     | 升级方向                                 |
| ------------ | ---------------------------------------- |
| AI 个股分析  | 扩展为"基于分析结果的选股"               |
| AI 聊天对话  | 升级为"策略意图识别 + 多轮对话构建策略"  |
| 市场情绪面板 | 作为因子输入（恐惧贪婪指数、涨跌家数等） |

### 9.2 数据层现有能力

| 数据类型  | 来源         | 用途              |
| --------- | ------------ | ----------------- |
| K 线行情  | 东方财富 API | 价量因子计算      |
| 分时数据  | 东方财富 API | 实时监控          |
| 资金流向  | 东方财富 API | 主力/北向资金因子 |
| 板块分类  | 待接入       | 板块筛选          |
| 新闻/公告 | 待接入       | 事件驱动因子      |
