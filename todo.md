# Stock Tracker 项目 TODO

## 后端基础架构
- [x] 配置数据库模型（股票基本信息、观察池、K线数据缓存、AI分析缓存）
- [x] 创建后端API路由结构（stocks、watchlist、kline、analysis、news）
- [x] 配置Tushare API集成和token管理
- [x] 实现Redis缓存层（使用数据库缓存）
- [x] 创建数据获取服务（实时行情、K线数据、财务数据）

## 数据集成
- [x] 集成Tushare API获取股票列表
- [x] 实现实时行情数据获取和缓存
- [x] 实现K线数据获取（日K/周K/月K）
- [x] 实现技术指标计算（MACD、RSI、均线）
- [ ] 实现资金流向数据获取
- [ ] 实现新闻数据抓取

## 前端UI - 股票列表页面
- [x] 设计并实现股票列表卡片组件
- [x] 显示股票代码、名称、价格、涨跌幅
- [x] 实现涨跌颜色区分（涨绿跌红）
- [x] 添加搜索和筛选功能
- [ ] 实现下拉刷新更新价格

## 前端UI - 股票详情页面
- [x] 创建股票详情页面布局
- [x] 显示基本信息（价格、开高低、成交量）
- [x] 集成TradingView Lightweight Charts K线图
- [x] 实现K线图时间周期切换（日K/周K/月K）
- [x] 实现K线图交互（缩放、拖拽、十字线）
- [x] 添加成交量柱状图

## 技术指标展示
- [x] 创建技术指标卡片组件
- [x] 显示MACD指标和信号
- [x] 显示RSI指标和超买超卖区域
- [x] 显示均线系统（MA5/MA20/MA60）
- [x] 以卡片形式展示关键技术信号

## 资金流向分析
- [x] 创建资金流向卡片组件
- [x] 显示主力资金净流入数据
- [ ] 显示北向资金动向（API待对接）
- [x] 显示换手率和成交额
- [ ] 添加资金流向趋势图表

## 前端 UI 布局优化 (2026-01-06)
- [x] 主页面三栏布局重构（自选股 + 中间区域 + AI助手）
- [x] AI 助手面板全高度显示（620px 宽度）
- [x] 股票标签页功能（多股票切换）
- [x] 资金指标独立行显示（紧跟股票价格）
- [x] 市场情绪面板（恐惧贪婪指数、市场温度、涨跌比、北向资金）
- [x] AI 思考模式时间显示
- [ ] 筹码分布功能实现（待对接API）
- [ ] 资金指标对接真实API
- [ ] 市场情绪指标对接真实API

## 新闻展示
- [ ] 创建新闻列表组件
- [ ] 抓取股票相关新闻
- [ ] 按时间排序展示
- [ ] 添加新闻来源和链接

## AI分析功能
- [x] 集成大语言模型API
- [x] 实现技术面分析（评分和信号）
- [ ] 实现情绪面分析（热度、讨论数）
- [ ] 实现资金面分析（资金流向评分）
- [x] 生成综合投资建议
- [x] 添加风险提示
- [x] 创建AI分析结果展示卡片

## 2026-01-09 待办
### AI 助手 UI 修复
- [ ] 代码块溢出聊天窗口问题（需添加水平滚动）
- [ ] 三个点加载动画显示问题

### AI 记忆系统（新功能）
- [ ] 实现用户偏好记忆持久化（如"资金票不需要看基本面"）
- [ ] 每次对话注入用户偏好到 System Prompt
- [ ] 支持用户手动添加/删除记忆
- [ ] 按股票类型分类记忆（资金票、价值股、成长股等）

## 观察池管理
- [x] 创建观察池数据表
- [x] 实现添加股票到观察池
- [x] 实现删除股票功能
- [ ] 实现编辑备注和目标价
- [x] 实现观察池列表展示
- [ ] 添加价格提醒功能

## 性能优化
- [x] 实现数据缓存策略
- [x] 优化API响应时间
- [ ] 添加加载状态和骨架屏
- [x] 实现错误处理和重试机制

## 测试和部署
- [ ] 编写后端API单元测试
- [ ] 测试前端交互流程
- [ ] 优化移动端响应式布局
- [ ] 创建项目检查点

## 错误处理和降级方案
- [x] 修复Tushare API权限错误的错误处理
- [x] 添加友好的错误提示信息
- [x] 实现数据降级方案（替换为东方财富 API）
- [x] 优化前端错误显示

## 东方财富API集成
- [x] 研究东方财富免费API接口
- [x] 创建东方财富API集成服务
- [x] 实现股票搜索功能
- [x] 实现股票行情获取
- [x] 实现K线数据获取
- [x] 替换后端所有Tushare调用
- [x] 测试API功能

## Bug修复
- [x] 修复观察池添加功能的数据库插入错误
- [x] 修复React列表渲染的key警告
- [x] 测试观察池添加和删除功能

## 界面重设计（苹果股票应用风格）
- [x] 修改布局为左右分栏结构（左侧股票列表，右侧详情）
- [x] 实现股票列表的实时行情数据显示
- [x] 添加股票列表项的点击选中效果
- [x] 优化视觉风格为苹果风格（浅色背景、简洁设计）
- [x] 实现详情页的K线图和数据展示
- [x] 添加响应式设计（移动端自适应）

## 交互优化
- [x] 修改点击交互，点击股票后直接在右侧显示详情
- [x] 在右侧嵌入K线图组件
- [x] 显示价格信息和技术指标
- [x] 移除"查看详情"按钮

## 数据修复
- [x] 修复换手率显示为"--"的问题
- [x] 修复市盈率显示为"--"的问题
- [x] 检查东方财富API返回的完整数据字段

## K线图优化
- [x] 添加分时图功能作为默认视图
- [x] 将基本信息移到K线图右侧
- [x] 减少K线数量从120条到60条
- [x] 获取分时数据API（使用东方财富分时接口）

## 腾讯自选股风格重设计
- [x] 切换为深色主题（专业金融风格）
- [x] 优化股票列表样式（涨跌幅圆角色块）
- [x] 丰富详情页数据网格（今开/昨收/最高/最低/换手率/市盈率等）
- [x] K线图深色配色适配
- [x] 添加成交量副图
- [ ] 添加五日K线选项

## Bug修复
- [x] 修复股票搜索功能错误（mutation改为query调用）

## AI 聊天功能
- [x] 集成流式聊天API（SSE）
- [x] 实现聊天历史持久化
- [x] 添加按股票分离的聊天记录
- [x] 实现"深度思考"模式切换
- [x] 添加消息操作按钮（复制/点赞/重新生成）
- [x] **Function Calling 实时数据查询**（2026-01-08）
  - [x] LLM 可主动调用股票 API 获取实时数据
  - [x] 支持股票搜索、行情查询、K线数据、资金流向等工具
  - [x] 多轮工具调用支持（最多5轮）
  - [x] 工具调用状态提示（🔍 正在查询数据...）
- [ ] 实现聊天记录搜索
- [ ] 添加聊天导出功能

## 迷你走势图优化
- [x] 居中显示迷你走势图
- [x] 添加0%基准线（昨收价）
- [x] 动态缩放显示范围
- [x] 移除K线图最新价格标签

## NLP 智能选股模块（2026-01-08 规划）

### Phase 1: 基础框架（2周）
- [ ] 在中间区域添加"🔍 智能选股" Tab
- [ ] 策略意图识别 Prompt 开发
- [ ] 策略 JSON Schema 定义
- [ ] 简化版因子引擎（价量因子：涨跌幅、换手率、量比）
- [ ] tRPC strategy.parseAndScan 接口
- [ ] 选股结果列表组件
- [ ] 点击结果 → 查看K线联动

### Phase 2: Skill 系统（2周）
- [ ] Skill 数据模型设计
- [ ] skill.create / skill.list / skill.delete 接口
- [ ] Skill 管理面板 UI
- [ ] skill.run 接口（手动执行）
- [ ] 定时任务框架（node-cron）
- [ ] Skill 执行历史记录

### Phase 3: 因子扩展（2周）
- [ ] 板块分类数据接入
- [ ] 资金因子集成（主力、北向）
- [ ] 板块筛选逻辑
- [ ] 新闻/公告数据源调研（可选）
- [ ] 新闻热度因子（可选）

### Phase 4: 回测 + 记忆（3周）
- [ ] 历史K线数据存储策略
- [ ] 回测逻辑实现
- [ ] 回测结果展示 UI
- [ ] 用户策略使用记录
- [ ] 因子使用频率统计
- [ ] "推荐 Skill 化"逻辑

### Phase 5: 向量存储与语义搜索（2周，P2 后期）
- [ ] 抽象 Repository 接口（降低迁移成本）
- [ ] 评估向量方案（MySQL + Embedding / ChromaDB / pgvector）
- [ ] 选择 Embedding 模型（OpenAI / 通义 / 本地 BGE）
- [ ] 数据表预留 embedding 字段
- [ ] 对话内容向量化
- [ ] AI 分析结论向量化
- [ ] 语义搜索接口（相似度检索）
- [ ] 选股时关联历史分析

### 数据存储方案
- [ ] MySQL 表结构设计（chat_messages, ai_analyses, skills）
- [ ] 抽象 ISearchRepository 接口
- [ ] 本地开发：继续用 JSON 文件
- [ ] 部署时：迁移到 MySQL + Redis

## 私有配置系统（长期规划）

### 架构设计
将个人数据与公开代码分离，支持跨设备同步和隐私保护：

```
📁 stock-tracker/              ← 公开仓库 (GitHub Public)
├── client/                     # 前端代码
├── server/                     # 后端代码
└── .env.example                # 环境变量示例

📁 stock-tracker-private/      ← 私有仓库 (GitHub Private)
├── preferences/                # 显示偏好
│   ├── theme.json              # 主题设置
│   ├── layout.json             # 布局偏好
│   ├── chart.json              # K线图偏好
│   └── notifications.json      # 通知设置
├── strategies/                 # 交易策略
│   ├── buy_rules.json          # 买入规则
│   ├── sell_rules.json         # 卖出规则
│   └── risk_config.json        # 风控参数
├── memory/                     # 记忆/历史
│   ├── chat_history/           # AI对话历史
│   ├── stock_notes.json        # 股票备注
│   └── trade_diary.json        # 交易日记
├── watchlist/                  # 自选股相关
│   ├── groups.json             # 分组
│   ├── targets.json            # 目标价/止损价
│   └── alerts.json             # 提醒规则
└── data/                       # 个人数据
    ├── positions.json          # 持仓记录
    └── performance.json        # 收益统计
```

### 待实现功能
- [ ] 创建私有数据加载器（UserConfigLoader）
- [ ] 实现环境变量配置（PRIVATE_DATA_PATH）
- [ ] 主题偏好配置与切换
- [ ] 布局偏好保存与恢复
- [ ] K线图偏好（默认周期、均线、指标）
- [ ] 交易策略插件化架构
- [ ] 买入/卖出规则配置界面
- [ ] 股票备注与标签系统
- [ ] 交易日记功能
- [ ] 自选股分组管理
- [ ] 目标价提醒功能
- [ ] 持仓记录与收益统计
- [ ] 多设备配置同步（git-based）
- [ ] 配置加密（git-crypt集成）

### 优势
- 🔒 安全性：策略/数据永远不会出现在公开仓库
- 🔄 可同步：私有仓库可以跨设备同步
- 📦 可备份：可以独立备份私有数据
- 🧩 可插拔：策略可以热加载/切换
- 👥 可协作：公开代码可以接受贡献，私有策略保密
