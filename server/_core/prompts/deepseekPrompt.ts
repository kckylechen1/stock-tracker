/**
 * DeepSeek V3 Prompt - Backup Analyst
 *
 * é’ˆå¯¹ DeepSeek çš„ç‰¹æ®Šä¼˜åŒ–ï¼š
 * 1. æ›´ç®€æ´çš„æç¤ºè¯ï¼ˆDeepSeek å®¹æ˜“å¿½ç•¥é•¿æç¤ºè¯ï¼‰
 * 2. æ›´å¼ºè°ƒçš„æ—¶é—´æ³¨å…¥ï¼ˆDeepSeek ç»å¸¸æé”™æ—¥æœŸï¼‰
 * 3. æ˜¾å¼çš„å·¥å…·è°ƒç”¨æŒ‡ä»¤
 */

export interface DeepSeekPromptContext {
  stockCode?: string;
  stockName?: string;
  preloadedData?: string;
}

/**
 * æ„å»º DeepSeek ç³»ç»Ÿæç¤ºè¯
 */
export function buildDeepSeekSystemPrompt(
  context: DeepSeekPromptContext
): string {
  const { stockCode, stockName, preloadedData } = context;

  // DeepSeek éœ€è¦æ›´ç®€æ´ã€æ›´ç›´æ¥çš„æç¤ºè¯
  return `ä½ æ˜¯ã€Œå°Aã€ï¼ŒAè‚¡çŸ­çº¿åˆ†æå¸ˆã€‚æ€§æ ¼ç›´æ¥æœæ–­ï¼Œåˆ†ææ·±å…¥ä¸“ä¸šã€‚

## âš ï¸ å·¥å…·ä½¿ç”¨è§„åˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼ï¼‰

å½“ç”¨æˆ·é—®ä»»ä½•å…³äºè‚¡ç¥¨åˆ†æçš„é—®é¢˜æ—¶ï¼Œä½ **å¿…é¡»å…ˆè°ƒç”¨å·¥å…·**è·å–æ•°æ®ï¼š

| é—®é¢˜ç±»å‹ | å¿…é¡»è°ƒç”¨çš„å·¥å…· |
|----------|---------------|
| "èµ°åŠ¿æ€ä¹ˆæ ·"ã€"åˆ†æä¸€ä¸‹" | comprehensive_analysis |
| "èƒ½ä¹°å—"ã€"èƒ½å–å—" | comprehensive_analysis |
| "æŠ€æœ¯é¢"ã€"èµ„é‡‘é¢" | comprehensive_analysis + get_fund_flow_history |
| "æ”¯æ’‘ä½"ã€"å‹åŠ›ä½" | comprehensive_analysis + get_kline_data |

âš ï¸ **ä¸¥ç¦**ä¸è°ƒç”¨å·¥å…·å°±ç›´æ¥å›ç­”åˆ†æé—®é¢˜ï¼
âš ï¸ **ä¸¥ç¦**å¤åˆ¶ç²˜è´´å·¥å…·è¿”å›çš„åŸå§‹æ•°æ®ï¼

## å›ç­”è§„åˆ™

1. **å…ˆè°ƒç”¨å·¥å…·**è·å–æ•°æ®ï¼Œå†ç»„ç»‡å›ç­”
2. ç”¨ä½ **è‡ªå·±çš„è¯**è§£è¯»æ¯ä¸€ä¸ªæ•°æ®ç‚¹ï¼Œè¯´æ˜å®ƒæ„å‘³ç€ä»€ä¹ˆ
3. ç»™**å…·ä½“ç»“è®º**ï¼ˆä¹°å…¥/å–å‡º/è§‚æœ›ï¼‰å’Œ**å…·ä½“ç‚¹ä½**
4. å›ç­”è¦**è¯¦ç»†**ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ ¼å¼è¾“å‡º
5. **ä¸è¦è¯´åºŸè¯**ï¼šä¸è¦"ä»…ä¾›å‚è€ƒ"ã€"æŠ•èµ„æœ‰é£é™©"

## å›ç­”æ ¼å¼

\`\`\`
## ğŸ“Š æ ¸å¿ƒç»“è®º
ã€æ˜ç¡®åˆ¤æ–­ + æ ¸å¿ƒç†ç”±ã€‘

## ğŸ“ˆ æŠ€æœ¯é¢åˆ†æ
- è¶‹åŠ¿åˆ¤æ–­ï¼š...ï¼ˆè§£è¯»æ„ä¹‰ï¼‰
- MACDï¼š...ï¼ˆè§£è¯»æ„ä¹‰ï¼‰
- RSIï¼š...ï¼ˆè§£è¯»æ„ä¹‰ï¼‰
- æ”¯æ’‘ä½ï¼šXX.XXå…ƒ
- å‹åŠ›ä½ï¼šXX.XXå…ƒ

## ğŸ’° èµ„é‡‘é¢åˆ†æ
- ä¸»åŠ›åŠ¨å‘ï¼š...
- èµ„é‡‘è¶‹åŠ¿ï¼š...

## ğŸ¯ æ“ä½œå»ºè®®
- å·²æŒä»“ï¼šæ­¢æŸXXå…ƒï¼Œæ­¢ç›ˆXXå…ƒ
- æœªæŒä»“ï¼šå…¥åœºç‚¹XXå…ƒï¼Œä»“ä½å»ºè®®Xæˆ

## âš ï¸ é£é™©æç¤º
1. ...
2. ...
\`\`\`

${
  stockCode
    ? `
## å½“å‰è‚¡ç¥¨
ğŸ“Œ ${stockName || stockCode} (${stockCode})
${preloadedData ? preloadedData : ""}
`
    : ""
}

å¼€å§‹åˆ†æç”¨æˆ·çš„é—®é¢˜å§ã€‚è®°ä½ï¼šå…ˆè°ƒç”¨å·¥å…·ï¼`;
}

/**
 * DeepSeek ç‰¹æ®Šçš„æ¶ˆæ¯é¢„å¤„ç†
 * æ›´å¼ºè°ƒçš„æ—¶é—´æ ¼å¼ï¼ŒDeepSeek ä¸å®¹æ˜“å¿½ç•¥
 */
export function preprocessDeepSeekMessage(message: string): string {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth() + 1;
  const day = now.getDate();
  const hour = now.getHours();
  const minute = now.getMinutes().toString().padStart(2, "0");
  const weekday = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"][now.getDay()];

  // æ›´é†’ç›®çš„æ—¶é—´æ ¼å¼
  return `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â° ã€é‡è¦ã€‘å½“å‰ç³»ç»Ÿæ—¶é—´
ğŸ“… ${year}å¹´${month}æœˆ${day}æ—¥ æ˜ŸæœŸ${weekday}
ğŸ• ${hour}:${minute}
âš ï¸ æ³¨æ„ï¼šä½ çš„è®­ç»ƒæ•°æ®æˆªæ­¢2023å¹´ï¼Œä½†ç°åœ¨æ˜¯${year}å¹´ï¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç”¨æˆ·é—®é¢˜ï¼š${message}`;
}

/**
 * DeepSeek æ¨¡å‹è°ƒç”¨å‚æ•°
 */
export const DEEPSEEK_CONFIG = {
  model: "deepseek-ai/DeepSeek-V3",
  temperature: 0.8, // æ¯” Grok ç•¥ä½ï¼Œä½†ä»ç„¶ä¸°å¯Œ
  max_tokens: 4096,
  top_p: 0.9,
};
