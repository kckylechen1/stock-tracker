# Stock Tracker NLP 选股系统 - 统一规划文档

**创建日期**: 2026-01-08  
**版本**: 3.0（融合完整版）  
**目标**: 将三份文档整合为技术团队的"圣经"

---

## 📋 核心导航

本文档融合了三份前期研究文档：

1. **product-summary.md** - 产品形态和用户场景
2. **nlp-strategy-design.md** - NLP理论和算法设计
3. **nlp-strategy-dev-plan.md** - 开发实施路线

**新读者快速上手**：

- 想了解产品 → 跳到第2章
- 想了解NLP设计 → 跳到第3章
- 想了解技术架构 → 跳到第4章
- 想了解开发计划 → 跳到第5章

---

## 1. 项目概览

### 1.1 项目名称和定位

**系统名称**: Stock Tracker NLP 选股系统

**定位**: 一个会记忆、能自主工作、可协作的A股交易研究助理

- ✅ 不是通用聊天AI
- ✅ 不是投资建议提供者
- ✅ 不是实盘交易执行系统
- ✅ 是"用自然语言选股"的专业工具

### 1.2 核心价值主张

> **"让AI成为你的交易记事本，而不是决策者"**

通过**记忆、自主监控、数据验证**三大能力，帮助投资者：

- 💭 记住所有交易想法（自然语言 + 聊天记录）
- ⏰ 自动跟踪关注的股票（自选池 + 提醒）
- 🎯 发现和复用最有效的策略（Skill系统）
- 📊 用数据验证策略的有效性（回测引擎）
- 🤝 与朋友协作研究和分享

### 1.3 差异化优势

| 维度     | 现有同花顺 | 现有量化平台  | 本系统              |
| -------- | ---------- | ------------- | ------------------- |
| 选股方式 | 复杂菜单   | 编程/数学公式 | **自然语言**        |
| 策略发现 | 手工尝试   | 因子库穷举    | **自动发现**        |
| 记忆能力 | 无记忆     | 无记忆        | **持久记忆**        |
| 回测验证 | 不支持     | 支持但复杂    | **一键回测**        |
| 容量评估 | 无         | 有但复杂      | **可视化评估**      |
| 协作分享 | 基础       | 无            | **完整的Skill分享** |

---

## 2. 产品形态（7个核心功能）

### 功能1: 聊天界面（记忆+协作）

**用途**: AI辅助讨论、自然语言选股入口

核心特性：

- 与AI对话讨论股票（像微信一样简单）
- 支持个人使用和群组协作
- AI自动识别股票代码、提取关键观点
- 完整聊天历史（可搜索）

**NLP增强**：

- 聊天时自动识别"选股意图"
- 若检测到选股请求，直接展示结果面板
- 例如：用户说"帮我找换手高的"，系统自动扫描并展示候选股

---

### 功能2: 观察池（TODO管理）

**用途**: 用户关注的股票清单

结构：

- 观察中（等待入场时机）
- 持仓提醒（已买入）
- 复盘清单（需要研究）

每只股票包含：

- 股票代码+名称
- 当前价格（实时更新）
- 目标价、入场价、出场价
- 添加时间和理由
- 触发提醒条件

智能功能：

- AI从聊天中自动提取"等回调到260"，创建TODO
- 价格到位时推送提醒
- 自动标记"已达目标""已超预期"

---

### 功能3: 交易策略库（Skill系统）

**用途**: 预设和自创的选股逻辑，支持自动监控

**内置Skill（3个）**：

1. **龙头补涨监控**
   - 逻辑：龙头股涨停后，板块内其他股票可能补涨
   - 执行：每天14:00
   - 输出：补涨候选TOP 5

2. **板块轮动监控**
   - 逻辑：主线板块连涨后，资金可能轮动到关联板块
   - 执行：每日收盘后
   - 输出：可能轮动的板块和个股

3. **游资追踪**
   - 逻辑：跟踪知名游资席位的买入动向
   - 执行：龙虎榜发布时
   - 输出：游资买入清单和板块偏好

**用户自创Skill**：

- 通过自然语言创建
- 系统自动发现（检测规律）
- 自动回测验证
- 支持定时自动运行

---

### 功能4: 回测工具

**用途**: 验证策略的历史有效性

使用流程：

1. "帮我回测龙头补涨策略，最近3个月"
2. 系统异步执行（通常30秒-2分钟）
3. 完成通知，展示报告

输出指标：

- 胜率、收益率、最大回撤、夏普比率
- 交易明细列表
- 参数优化建议

---

### 功能5: 记忆库

**用途**: 长期记住用户对每只股票的观点

记忆内容：

- 用户说过的每句话（关于某只股票）
- 添加到观察池的时间和理由
- 历史操作记录（买入/卖出）
- AI的分析建议历史

查询方式：

- "我之前怎么看比亚迪的？"
- 系统展示时间线 + 观点演变

---

### 功能6: 截图识别导入（待实现）

**用途**: 快速从其他平台导入自选股

流程：

1. 上传股票自选清单截图
2. 系统OCR识别代码/名称
3. 批量导入到观察池

应用场景：

- 微信群/雪球分享的自选股截图
- 其他软件的自选股列表
- 手写笔记拍照
- 研报中的股票列表

---

### 功能7: 一键发布（待实现）

**用途**: 知识沉淀和团队分享

可发布内容：

- 观察池（飞书多维表格，实时同步）
- 分析报告（飞书文档/Notion页面）
- 回测报告（Notion Database）
- 讨论记录（飞书文档，会议纪要格式）

---

## 3. NLP 策略设计（算法层）

### 3.1 自然语言到因子映射

用户说的话 → 系统理解的因子 → 执行扫描

**示例**：

```
用户: "帮我找最近5-15天有利好新闻、但股价没大涨、
      换手在3-10%、量比刚放大的半导体股"

系统解析:
{
  "sectors": ["半导体"],
  "event_window_days": [5, 15],
  "event_type": ["重大利好", "产业政策"],
  "price_change_3d_max": 0.15,
  "turnover_range": [3, 10],
  "volume_ratio_min": 1.0
}

执行结果: 6只候选股
```

### 3.2 四维度因子体系

**维度1: 趋势 (Trend)**

- 时间窗口（最近N天）
- 涨跌幅范围
- K线形态（突破、新高等）
- 排除涨停/跌停

**维度2: 量能 (Volume)**

- 换手率范围
- 量比（最小值）
- 放量模式
- 成交额大小

**维度3: 资金 (Capital)**

- 主力资金方向（流入/流出）
- 北向资金状态
- 游资参与度
- 机构持仓变化

**维度4: 事件 (Event)**

- 新闻/公告类型
- 事件时间窗口
- 情感倾向（正面/负面）
- 热度等级

**维度5: 市值 (Market Cap)**

- 市值范围
- 小盘/中盘/大盘

**维度6: 季节性 (Seasonality)**

- 年终避险、春节行情等
- 时间窗口

### 3.3 Skill 生命周期

```
发现期 → 建议期 → 验证期 → 运行期 → 评估期 → 迭代期 → 退役期

发现期：用户频繁用类似自然语言筛选
  ↓
建议期：系统提示"是否固化为Skill？"
  ↓
验证期：自动触发回测 + 容量评估
  ↓
运行期：用户正式启用，每日/周自动运行
  ↓
评估期：定期对比实际表现 vs 回测表现
  ↓
迭代期：逻辑调整、因子更新
  ↓
退役期：长期失效/拥挤度高时，建议停用
```

### 3.4 容量问题处理

**为什么要考虑容量？**

- 传统量化策略随资金规模增大，收益下滑
- 我们虽不是高频，但公开逻辑在同一市场也会拥挤

**产品层面怎么做？**

1. **在Skill详情页展示容量估算**
   - 基于成交额和换手率
   - 建议资金规模范围

2. **提示拥挤风险**
   - 检测大量用户使用
   - 检测网上高频讨论
   - 打"高拥挤风险"标签

3. **鼓励个性化微调**
   - 提供参数调整接口
   - 形成"个人版Skill"
   - 降低拥挤冲突

---

## 4. 技术架构（全景）

### 4.1 系统全景

```
┌──────────────────────────────────────────────────────┐
│              前端 (React + TypeScript)               │
│  聊天 | K线 | 自选股 | Skill管理 | 回测报告 | 分析    │
└─────────────────────┬────────────────────────────────┘
                      │ HTTP/WebSocket
                      ↓
┌──────────────────────────────────────────────────────┐
│            后端 (Node.js + tRPC)                      │
├──────────────────────────────────────────────────────┤
│ AI/LLM服务     | 策略执行引擎  | Skill管理          │
│ 因子计算       | 回测模块      | 记忆系统           │
│ 数据获取       | 定时任务      | API服务            │
└─────────────────────┬────────────────────────────────┘
                      │ TCP/HTTP
                      ↓
┌──────────────────────────────────────────────────────┐
│         外部系统和数据源                              │
│ Mattermost | 东方财富API | LLM服务 | 飞书/Notion   │
└──────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────┐
│            数据持久化                                 │
│ PostgreSQL (核心数据) | Redis (缓存) | 历史数据     │
└──────────────────────────────────────────────────────┘
```

### 4.2 后端模块划分（15个）

```
【数据获取层】
├─ data/market_data.py - 行情数据（K线、分时）
├─ data/factor_calculator.py - 因子计算
└─ data/cache_manager.py - Redis缓存

【AI和策略层】
├─ ai/llm_service.py - LLM调用
├─ strategy/intent_recognition.py - 意图识别
├─ strategy/parser.py - 自然语言解析
├─ strategy/executor.py - 策略执行
└─ strategy/backtester.py - 回测引擎

【业务逻辑层】
├─ skill/manager.py - Skill CRUD
├─ skill/scheduler.py - 定时任务
├─ memory/extractor.py - 记忆提取
├─ analysis/reporter.py - 报告生成
└─ export/publisher.py - 发布功能

【聊天集成层】
├─ mattermost/webhook_handler.py - Webhook处理
└─ mattermost/api_client.py - API客户端

【通用层】
├─ config/settings.py - 配置
└─ utils/database.py - 数据库操作
```

### 4.3 前端组件结构

```
src/
├─ components/
│  ├─ ChatPanel.tsx - 聊天面板（增强）
│  ├─ KlineChart.tsx - K线图
│  ├─ WatchlistPanel.tsx - 自选股
│  ├─ SkillManagementPanel.tsx - Skill管理
│  ├─ StrategyResultPanel.tsx - 策略结果
│  ├─ BacktestReport.tsx - 回测报告
│  └─ MarketSentiment.tsx - 市场情绪
│
├─ hooks/
│  ├─ useChat.ts
│  ├─ useStrategy.ts
│  ├─ useSkill.ts
│  └─ useMarketData.ts
│
└─ pages/
   ├─ Dashboard.tsx - 主页
   ├─ SkillLibrary.tsx - Skill库
   └─ Analysis.tsx - 分析页
```

---

## 5. 开发路线图（8周MVP）

### Phase 1: 基础框架（第1-2周）

**目标**: 打通自然语言 → 策略JSON → 扫描 → 结果展示

**交付物**: 用户说"帮我找换手高的"，系统返回候选股列表

- Week 1: Prompt开发、数据库设计、API路由
- Week 2: 因子引擎、前端结果面板

### Phase 2: Skill系统（第3-4周）

**目标**: 支持策略保存、运行、管理

**交付物**: 用户可保存策略为Skill，一键运行

- Week 3: Skill CRUD接口、管理面板
- Week 4: 定时任务、执行记录

### Phase 3: 因子扩展（第5-6周）

**目标**: 支持更多因子维度

**交付物**: 支持资金因子、板块筛选、事件驱动

- Week 5: 板块数据、资金因子
- Week 6: 事件因子、综合评分

### Phase 4: 高级功能（第7-8周）

**目标**: 回测、记忆、分享完整

**交付物**: MVP完整版本发布

- Week 7: 回测引擎、记忆系统
- Week 8: 一键发布、完整测试

---

## 6. 数据模型（13个核心表）

### 关键表

```
users - 用户基本信息
  ├─ 角色权限
  └─ 偏好设置

strategies - 用户创建的策略
  └─ 完整配置JSON

skills - 可复用的Skill库
  ├─ 配置信息
  ├─ 回测结果
  └─ 使用统计

skill_user_links - 用户和Skill的关系
  └─ 个性化参数

skill_runs - Skill执行记录
  └─ 执行结果

user_watchlist_stocks - 自选股
  ├─ 目标价
  └─ 提醒条件

chat_messages - 聊天记录
  ├─ 完整历史
  └─ 向量搜索预留

user_memory - 用户记忆库
  ├─ 观点记录
  └─ 因子偏好

backtest_results - 回测结果
  └─ 详细指标

stocks - 股票基本信息
  └─ 缓存数据

market_sentiment - 市场情绪快照
  └─ 时间序列

ai_analysis_history - AI分析历史
  └─ 向量搜索预留
```

---

## 7. API 接口汇总

### tRPC 路由

```typescript
// 策略相关
strategy.parseAndScan(); // 解析+执行
strategy.parse(); // 仅解析

// Skill相关
skill.create();
skill.list();
skill.run();
skill.delete();
skill.getBacktestResult();

// 回测相关
backtest.run();
backtest.getResult();

// 聊天相关（现有）
chat.send();
chat.history();

// 观察池相关
watchlist.add();
watchlist.remove();
watchlist.list();

// 记忆相关
memory.search();
memory.getFactorPreference();
```

---

## 8. MVP范围界定

### ✅ 必须包含

1. 自然语言选股入口
2. 基础因子扫描（价量）
3. 结果展示和解释
4. Skill保存和运行
5. 聊天系统集成

### ⏳ MVP后迭代

1. 资金因子
2. 事件驱动
3. 回测模块
4. 记忆系统
5. 截图识别
6. 一键发布

---

## 9. 关键文档交叉引用

深入了解各部分内容：

| 主题       | 对应文档                   | 关键章节               |
| ---------- | -------------------------- | ---------------------- |
| Prompt工程 | 01_Prompt_Design.md        | 第2章（6个核心Prompt） |
| 数据模型   | 02_Data_Model.md           | 第2章（13个表设计）    |
| 集成细节   | 03_Integration_Plan.md     | 第2-4章（融合方案）    |
| 技术栈     | 原nlp-strategy-dev-plan.md | 第2-5章                |

---

## 10. 下一步行动

### 立即执行（本周）

1. 审核本文档，确认产品方向
2. 技术方案评审
3. 数据库初始化脚本
4. Prompt初版测试

### 开发启动（下周）

1. 开发环境搭建
2. Phase 1实现启动
3. 内部测试版本

### 目标时间表

- 2026-01-26: Phase 1完成
- 2026-02-09: Phase 2完成
- 2026-02-23: Phase 3完成
- 2026-03-09: Phase 4完成（MVP发布）

---

**文档整合**: 2026-01-08  
**版本**: 3.0（融合完整版）  
**维护者**: 产品和技术团队  
**上次更新**: 2026-01-08 21:40 CST
